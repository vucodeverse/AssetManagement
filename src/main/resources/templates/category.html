<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Quản Lý Danh Mục</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

  <style>
    body { font-family: 'Roboto', sans-serif; }
    .header-title {
        font-weight: 700; color: #000; text-transform: uppercase;
        border-bottom: 1px solid #dee2e6; padding-bottom: 15px; margin-bottom: 20px;
    }
    .btn-primary { background-color: #0d6efd; }
    .table th { font-weight: 600; background-color: #fff; border-bottom: 2px solid #dee2e6; }
    .form-control:disabled, .form-control[readonly] { background-color: #e9ecef; opacity: 1; }
    .page-link { color: #0d6efd; }
    .page-item.active .page-link { background-color: #0d6efd; border-color: #0d6efd; }
    .toast-container { position: fixed; top: 20px; right: 20px; z-index: 1055; }
    /* Giữ class g-8 của bạn (lưu ý bootstrap chuẩn chỉ đến g-5, bạn có thể custom css thêm) */
  </style>
</head>
<body>

<div class="toast-container">
  <div th:if="${successMessage}" class="toast align-items-center text-white bg-success border-0 show" role="alert">
    <div class="d-flex">
      <div class="toast-body"><i class="fas fa-check-circle me-2"></i><span th:text="${successMessage}"></span></div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>
  </div>
  <div th:if="${errorMessage}" class="toast align-items-center text-white bg-danger border-0 show" role="alert">
    <div class="d-flex">
      <div class="toast-body"><i class="fas fa-exclamation-triangle me-2"></i><span th:text="${errorMessage}"></span></div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>
  </div>
</div>

<div class="container-fluid bg-white py-4">
  <div class="d-flex align-items-center mb-4">
    <button class="btn btn-link text-dark me-3"><i class="fas fa-bars fa-lg"></i></button>
    <h4 class="header-title m-0 flex-grow-1">QUẢN LÝ DANH MỤC TÀI SẢN</h4>
  </div>

  <div class="row mx-5"> <div class="col-lg-8 pe-5"> <div class="d-flex justify-content-between align-items-center mb-3">
    <h5 class="fw-bold mb-0">Danh sách danh mục</h5>
    <form th:action="@{/categories}" method="get" class="d-flex w-50">
      <div class="input-group">
        <input type="text" class="form-control" placeholder="Tìm kiếm danh mục..." name="search" th:value="${param.search}">
        <button class="btn btn-outline-primary" type="submit"><i class="fas fa-search"></i></button>
      </div>
    </form>
  </div>

    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead>
        <tr>
          <th scope="col" style="width: 10%;">ID</th>
          <th scope="col" style="width: 30%;">
            <a class="text-decoration-none text-dark" th:href="@{/categories(sort='categoryName,' + (${sortDir}=='asc' ? 'desc' : 'asc'))}">
              Tên danh mục <i class="fas fa-sort ms-1 text-muted"></i>
            </a>
          </th>
          <th scope="col">Mô tả</th>
          <th scope="col" class="text-end" style="width: 15%;">Hành động</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="cat : ${categoryPage.content}">
          <td th:text="${cat.categoryId}">1</td>
          <td class="fw-bold" th:text="${cat.categoryName}">Máy tính xách tay</td>
          <td th:text="${cat.description}">Thiết bị điện tử cấp phát cho nhân viên</td>
          <td class="text-end">
            <a th:href="@{/categories(id=${cat.categoryId}, mode='view')}" class="btn btn-sm btn-link text-dark" title="Xem">
              <i class="far fa-eye"></i>
            </a>
            <form th:action="@{/categories/{id}?delete(id=${cat.categoryId})}" method="post" class="d-inline" onsubmit="return confirm('Bạn có chắc muốn xóa danh mục này?');">
              <button type="submit" class="btn btn-sm btn-link text-danger" title="Xóa">
                <i class="far fa-trash-alt"></i>
              </button>
            </form>
          </td>
        </tr>
        <tr th:if="${categoryPage.empty}">
          <td colspan="4" class="text-center text-muted py-4">Chưa có danh mục nào</td>
        </tr>
        </tbody>
      </table>
    </div>

    <nav th:if="${categoryPage.totalPages > 1}">
      <ul class="pagination justify-content-center">
        <li class="page-item" th:classappend="${categoryPage.first} ? 'disabled'">
          <a class="page-link" th:href="@{/categories(page=${categoryPage.number - 1})}">&laquo;</a>
        </li>
        <li class="page-item" th:each="i : ${#numbers.sequence(0, categoryPage.totalPages - 1)}"
            th:classappend="${categoryPage.number == i} ? 'active'">
          <a class="page-link" th:href="@{/categories(page=${i})}" th:text="${i + 1}">1</a>
        </li>
        <li class="page-item" th:classappend="${categoryPage.last} ? 'disabled'">
          <a class="page-link" th:href="@{/categories(page=${categoryPage.number + 1})}">&raquo;</a>
        </li>
      </ul>
    </nav>
  </div>

    <div class="col-lg-4 ps-4 border-start"> <div class="bg-white">
      <h5 class="fw-bold mb-4"
          th:text="${mode == 'create' ? 'Tạo mới danh mục' : (mode == 'view' ? 'Chi tiết danh mục' : 'Cập nhật danh mục')}">
      </h5>

      <form th:action="${mode == 'create' ? '/categories?add' : '/categories?save'}"
            th:object="${categoryDto}" method="post">

        <input type="hidden" th:field="*{categoryId}">

        <div class="mb-3">
          <label class="form-label text-muted small">Tên danh mục <span class="text-danger">*</span></label>
          <input type="text" class="form-control" th:field="*{categoryName}"
                 th:readonly="${mode == 'view'}"
                 th:classappend="${#fields.hasErrors('categoryName')} ? 'is-invalid'"
                 placeholder="Ví dụ: Bàn ghế, Máy móc...">
          <div class="invalid-feedback" th:errors="*{categoryName}">Tên danh mục không hợp lệ</div>
        </div>

        <div class="mb-3">
          <label class="form-label text-muted small">Mô tả</label>
          <textarea class="form-control" rows="4" th:field="*{description}"
                    th:readonly="${mode == 'view'}"
                    placeholder="Nhập mô tả chi tiết..."></textarea>
        </div>

        <div class="mt-4">
          <div th:if="${mode == 'create'}">
            <button type="submit" class="btn btn-dark px-4 me-2">Tạo mới</button>
            <a href="/categories" class="btn btn-outline-secondary">Làm mới</a>
          </div>

          <div th:if="${mode == 'view'}">
            <a th:href="@{/categories(id=${categoryDto.categoryId}, mode='edit')}" class="btn btn-primary px-4 me-2">Cập nhật</a>

            <button type="submit" formmethod="post"
                    th:formaction="@{/categories/{id}?delete(id=${categoryDto.categoryId})}"
                    class="btn btn-outline-danger"
                    onclick="return confirm('Xóa danh mục này?')">Xóa</button>

            <a href="/categories" class="btn btn-link text-decoration-none text-muted float-end">Quay lại</a>
          </div>

          <div th:if="${mode == 'edit'}">
            <button type="submit" class="btn btn-primary px-4 me-2">Lưu thay đổi</button>
            <a th:href="@{/categories(id=${categoryDto.categoryId}, mode='view')}" class="btn btn-outline-secondary">Hủy bỏ</a>
          </div>
        </div>
      </form>
    </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>